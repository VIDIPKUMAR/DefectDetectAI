# monitoring/prometheus.yml
global:
  scrape_interval: 15s
  evaluation_interval: 15s

scrape_configs:
  - job_name: "defect-detector"
    static_configs:
      - targets: ["defect-detector-service:80"]
    metrics_path: "/metrics"
    scrape_interval: 10s

  - job_name: "kubernetes-pods"
    kubernetes_sd_configs: # âœ… FIXED: Changed from kubernetes_sdiscovery
      - role: pod
    relabel_configs:
      - source_labels: [__meta_kubernetes_pod_label_app]
        action: keep
        regex: defect-detector
      - source_labels: [__meta_kubernetes_pod_container_port_number]
        action: keep
        regex: 8000

  - job_name: "kubernetes-nodes"
    kubernetes_sd_configs:
      - role: node
    relabel_configs:
      - action: labelmap
        regex: __meta_kubernetes_node_label_(.+)

  - job_name: "kubernetes-services"
    kubernetes_sd_configs:
      - role: service

  - job_name: "redis"
    static_configs:
      - targets: ["redis-service:6379"]
    metrics_path: /metrics
